import{d as z,e as r,f as F,u as q,g as G,h as D,r as J,c as s,o as l,l as w,j as f,b as A,w as B,a as n,m as K,t as d,F as $,i as M,v as O,k as Q,n as h,p as U}from"./index-B3u5yad-.js";import{a as W,r as X}from"./contentService-Bp1UJfrT.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z=z({name:"EntryPage",setup(){const e=q(),t=r(!0),c=r(!1),p=r(null),y=r(""),v=r(!1),u=r(""),o=r(""),L=r({top:"0px",left:"0px"}),k=r(null),E=F(()=>e.params.type),H=F(()=>e.params.id),R=F(()=>{switch(E.value){case"characters":return"人物";case"locations":return"地点";case"events":return"事件";default:return"未知分类"}}),N=r({"《创世纪》第一章":"/works/genesis-chapter-1"}),S=()=>{if(!p.value){y.value="";return}y.value=X(p.value.content,c.value)},b=async()=>{t.value=!0;try{const i=await W(E.value,H.value);p.value=i,S()}catch(i){console.error("Failed to load entry",i)}finally{t.value=!1}};G(b),D([()=>e.params.type,()=>e.params.id],([i,m],[a,C])=>{(i!==a||m!==C)&&b()}),D(c,()=>{S()});const V=i=>{const a=i.target.closest(".spoiler");a&&!a.classList.contains("revealed")&&(a.classList.add("revealed"),g())},P=i=>{const a=i.target.closest(".spoiler");if(a&&!a.classList.contains("revealed")){k.value=a;const C=a.getAttribute("data-source")||"剧透内容";u.value=C,o.value=N.value[C]||"";const T=a.getBoundingClientRect();L.value={top:`${T.top-50}px`,left:`${T.left+T.width/2}px`},v.value=!0}},I=()=>{g()},j=()=>{k.value&&(k.value.classList.add("revealed"),g())},g=()=>{v.value=!1,k.value=null};return{categoryType:E,categoryTitle:R,loading:t,entry:p,parsedContent:y,showAllSpoilers:c,handleEntryBodyClick:V,handleEntryBodyHover:P,handleRevealSpoiler:j,handleCloseTooltip:g,handleTooltipLinkClick:I,showTooltip:v,tooltipText:u,tooltipLink:o,tooltipStyle:L}}}),_={class:"entry-page"},x={key:0,class:"loading"},ee={key:1,class:"not-found"},te={key:2,class:"entry-content"},oe={key:0,class:"tags"},le={class:"spoiler-controls"},se=["innerHTML"],ne={key:1,class:"related"},ae={class:"navigation"},re={class:"tooltip-title"},ie={class:"tooltip-actions"};function ue(e,t,c,p,y,v){const u=J("router-link");return l(),s("div",_,[e.loading?(l(),s("div",x," 加载中... ")):e.entry?(l(),s("div",te,[n("h1",null,d(e.entry.title),1),e.entry.tags&&e.entry.tags.length>0?(l(),s("div",oe,[(l(!0),s($,null,M(e.entry.tags,o=>(l(),s("span",{class:"tag",key:o},d(o),1))),128))])):w("",!0),n("div",le,[n("button",{onClick:t[0]||(t[0]=o=>e.showAllSpoilers=!e.showAllSpoilers),class:"spoiler-toggle"},d(e.showAllSpoilers?"隐藏所有剧透":"我不怕剧透"),1)]),n("div",{class:"entry-body",innerHTML:e.parsedContent,onClick:t[1]||(t[1]=(...o)=>e.handleEntryBodyClick&&e.handleEntryBodyClick(...o)),onMouseover:t[2]||(t[2]=(...o)=>e.handleEntryBodyHover&&e.handleEntryBodyHover(...o))},null,40,se),e.entry.related&&e.entry.related.length>0?(l(),s("div",ne,[t[9]||(t[9]=n("h3",null,"相关条目",-1)),n("ul",null,[(l(!0),s($,null,M(e.entry.related,o=>(l(),s("li",{key:o},d(o),1))),128))])])):w("",!0),n("div",ae,[A(u,{to:`/category/${e.categoryType}`,class:"back-link"},{default:B(()=>[f(" 返回"+d(e.categoryTitle)+"列表 ",1)]),_:1},8,["to"])]),K(n("div",{class:"spoiler-tooltip",style:U(e.tooltipStyle)},[n("div",re,d(e.tooltipText),1),n("div",ie,[e.tooltipLink?(l(),Q(u,{key:0,to:e.tooltipLink,class:"tooltip-btn tooltip-link",onClick:h(e.handleTooltipLinkClick,["stop"])},{default:B(()=>t[10]||(t[10]=[f(" 前往原作 ")])),_:1},8,["to","onClick"])):(l(),s("button",{key:1,class:"tooltip-btn tooltip-pending",onClick:t[3]||(t[3]=h((...o)=>e.handleCloseTooltip&&e.handleCloseTooltip(...o),["stop"]))}," 敬请催更 ")),n("button",{class:"tooltip-btn tooltip-reveal",onClick:t[4]||(t[4]=h((...o)=>e.handleRevealSpoiler&&e.handleRevealSpoiler(...o),["stop"]))}," 查看剧透 ")]),n("button",{class:"tooltip-close",onClick:t[5]||(t[5]=h((...o)=>e.handleCloseTooltip&&e.handleCloseTooltip(...o),["stop"]))},"×")],4),[[O,e.showTooltip]])])):(l(),s("div",ee,[t[8]||(t[8]=f(" 未找到该条目信息 ")),A(u,{to:"/",class:"back-link"},{default:B(()=>t[7]||(t[7]=[f("返回首页")])),_:1})])),e.showTooltip?(l(),s("div",{key:3,class:"overlay",onClick:t[6]||(t[6]=(...o)=>e.handleCloseTooltip&&e.handleCloseTooltip(...o))})):w("",!0)])}const ye=Y(Z,[["render",ue],["__scopeId","data-v-45a0e60c"]]);export{ye as default};
